{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to cropengine","text":"<p>cropengine is a Python package that streamlines running process-based crop models by automating data preparation, simulation workflows, and result analysis.</p> <ul> <li>Free software: MIT License</li> <li>Documentation: https://geonextgis.github.io/cropengine</li> </ul>"},{"location":"#features","title":"Features","text":"<ul> <li>TODO</li> </ul>"},{"location":"changelog/","title":"Changelog","text":""},{"location":"changelog/#v001-date","title":"v0.0.1 - Date","text":"<p>Improvement:</p> <ul> <li>TBD</li> </ul> <p>New Features:</p> <ul> <li>TBD</li> </ul>"},{"location":"contributing/","title":"Contributing","text":"<p>Contributions are welcome, and they are greatly appreciated! Every little bit helps, and credit will always be given.</p> <p>You can contribute in many ways:</p>"},{"location":"contributing/#types-of-contributions","title":"Types of Contributions","text":""},{"location":"contributing/#report-bugs","title":"Report Bugs","text":"<p>Report bugs at https://github.com/geonextgis/cropengine/issues.</p> <p>If you are reporting a bug, please include:</p> <ul> <li>Your operating system name and version.</li> <li>Any details about your local setup that might be helpful in troubleshooting.</li> <li>Detailed steps to reproduce the bug.</li> </ul>"},{"location":"contributing/#fix-bugs","title":"Fix Bugs","text":"<p>Look through the GitHub issues for bugs. Anything tagged with <code>bug</code> and <code>help wanted</code> is open to whoever wants to implement it.</p>"},{"location":"contributing/#implement-features","title":"Implement Features","text":"<p>Look through the GitHub issues for features. Anything tagged with <code>enhancement</code> and <code>help wanted</code> is open to whoever wants to implement it.</p>"},{"location":"contributing/#write-documentation","title":"Write Documentation","text":"<p>cropengine could always use more documentation, whether as part of the official cropengine docs, in docstrings, or even on the web in blog posts, articles, and such.</p>"},{"location":"contributing/#submit-feedback","title":"Submit Feedback","text":"<p>The best way to send feedback is to file an issue at https://github.com/geonextgis/cropengine/issues.</p> <p>If you are proposing a feature:</p> <ul> <li>Explain in detail how it would work.</li> <li>Keep the scope as narrow as possible, to make it easier to implement.</li> <li>Remember that this is a volunteer-driven project, and that contributions are welcome :)</li> </ul>"},{"location":"contributing/#get-started","title":"Get Started!","text":"<p>Ready to contribute? Here's how to set up cropengine for local development.</p> <ol> <li> <p>Fork the cropengine repo on GitHub.</p> </li> <li> <p>Clone your fork locally:</p> <pre><code>$ git clone git@github.com:your_name_here/cropengine.git\n</code></pre> </li> <li> <p>Install your local copy into a virtualenv. Assuming you have     virtualenvwrapper installed, this is how you set up your fork for     local development:</p> <pre><code>$ mkvirtualenv cropengine\n$ cd cropengine/\n$ python setup.py develop\n</code></pre> </li> <li> <p>Create a branch for local development:</p> <pre><code>$ git checkout -b name-of-your-bugfix-or-feature\n</code></pre> <p>Now you can make your changes locally.</p> </li> <li> <p>When you're done making changes, check that your changes pass flake8     and the tests, including testing other Python versions with tox:</p> <pre><code>$ flake8 cropengine tests\n$ python setup.py test or pytest\n$ tox\n</code></pre> <p>To get flake8 and tox, just pip install them into your virtualenv.</p> </li> <li> <p>Commit your changes and push your branch to GitHub:</p> <pre><code>$ git add .\n$ git commit -m \"Your detailed description of your changes.\"\n$ git push origin name-of-your-bugfix-or-feature\n</code></pre> </li> <li> <p>Submit a pull request through the GitHub website.</p> </li> </ol>"},{"location":"contributing/#pull-request-guidelines","title":"Pull Request Guidelines","text":"<p>Before you submit a pull request, check that it meets these guidelines:</p> <ol> <li>The pull request should include tests.</li> <li>If the pull request adds functionality, the docs should be updated.     Put your new functionality into a function with a docstring, and add     the feature to the list in README.rst.</li> <li>The pull request should work for Python 3.8 and later, and     for PyPy. Check https://github.com/geonextgis/cropengine/pull_requests and make sure that the tests pass for all     supported Python versions.</li> </ol>"},{"location":"cropengine/","title":"cropengine module","text":"<p>Main module.</p>"},{"location":"faq/","title":"FAQ","text":""},{"location":"installation/","title":"Installation","text":""},{"location":"installation/#stable-release","title":"Stable release","text":"<p>To install cropengine, run this command in your terminal:</p> <pre><code>pip install cropengine\n</code></pre> <p>This is the preferred method to install cropengine, as it will always install the most recent stable release.</p> <p>If you don't have pip installed, this Python installation guide can guide you through the process.</p>"},{"location":"installation/#from-sources","title":"From sources","text":"<p>To install cropengine from sources, run this command in your terminal:</p> <pre><code>pip install git+https://github.com/geonextgis/cropengine\n</code></pre>"},{"location":"usage/","title":"Usage","text":"<p>To use cropengine in a project:</p> <pre><code>import cropengine\n</code></pre>"},{"location":"weather/","title":"weather module","text":"<p>Module to prepare weather data</p>"},{"location":"weather/#cropengine.weather.ClimateConfig","title":"<code> ClimateConfig        </code>","text":"<p>Parses and holds configuration for climate variables.</p> Source code in <code>cropengine/weather.py</code> <pre><code>class ClimateConfig:\n    \"\"\"Parses and holds configuration for climate variables.\"\"\"\n\n    def __init__(self, config_dict):\n        self.raw = config_dict\n        self.variables = config_dict[\"variables\"]\n        self.all_bands = []\n        self.var_to_bands = {}\n        self.var_to_units = {}\n        self.var_to_conversion = {}\n        self.derived = set()\n        self._parse_variables()\n\n    def _parse_variables(self):\n        for var_name, info in self.variables.items():\n            self.var_to_units[var_name] = (\n                info.get(\"native_unit\"),\n                info.get(\"target_unit\"),\n            )\n            self.var_to_conversion[var_name] = info.get(\"conversion\")\n            if info.get(\"derived\", False):\n                self.derived.add(var_name)\n\n            bands = []\n            for key, value in info.items():\n                if key.startswith(\"band\") and value is not None:\n                    bands.append(value)\n                    self.all_bands.append(value)\n            self.var_to_bands[var_name] = bands\n\n    def get_all_bands(self):\n        return list(set(self.all_bands))\n\n    def is_derived(self, var_name):\n        return var_name in self.derived\n</code></pre>"},{"location":"weather/#cropengine.weather.GEEWeatherDataProvider","title":"<code> GEEWeatherDataProvider        </code>","text":"<p>Handles data retrieval, processing, and export of weather data from Google Earth Engine in PCSE format.</p> <p>IMPORTANT: This class strictly handles POINT data. If a Geometry/Polygon is provided, it extracts data for the CENTROID of that geometry only.</p> <p>Parameters:</p> Name Type Description Default <code>start_date</code> <code>str</code> <p>Start date (YYYY-MM-DD).</p> required <code>end_date</code> <code>str</code> <p>End date (YYYY-MM-DD).</p> required <code>latitude</code> <code>float</code> <p>Latitude (if geometry not provided).</p> <code>None</code> <code>longitude</code> <code>float</code> <p>Longitude (if geometry not provided).</p> <code>None</code> <code>geometry</code> <code>ee.Geometry</code> <p>Polygon or geometry object. Will be converted to its Centroid.</p> <code>None</code> <code>source</code> <code>str</code> <p>Key in meteo.yaml (e.g., 'era5_land').</p> <code>'era5_land'</code> <code>filepath</code> <code>str</code> <p>Default output path.</p> <code>None</code> <code>ee_project</code> <code>str</code> <p>GCloud project ID for GEE initialization.</p> <code>None</code> <code>**site_kwargs</code> <p>Extra metadata for the Excel header (e.g., Station, Country).</p> <code>{}</code> Source code in <code>cropengine/weather.py</code> <pre><code>class GEEWeatherDataProvider:\n    \"\"\"\n    Handles data retrieval, processing, and export of weather data from Google Earth Engine in PCSE format.\n\n    IMPORTANT: This class strictly handles POINT data. If a Geometry/Polygon is provided,\n    it extracts data for the CENTROID of that geometry only.\n\n    Args:\n        start_date (str): Start date (YYYY-MM-DD).\n        end_date (str): End date (YYYY-MM-DD).\n        latitude (float, optional): Latitude (if geometry not provided).\n        longitude (float, optional): Longitude (if geometry not provided).\n        geometry (ee.Geometry, optional): Polygon or geometry object. Will be converted to its Centroid.\n        source (str): Key in meteo.yaml (e.g., 'era5_land').\n        filepath (str, optional): Default output path.\n        ee_project (str, optional): GCloud project ID for GEE initialization.\n        **site_kwargs: Extra metadata for the Excel header (e.g., Station, Country).\n    \"\"\"\n\n    def __init__(\n        self,\n        start_date,\n        end_date,\n        latitude=None,\n        longitude=None,\n        geometry=None,\n        source=\"era5_land\",\n        filepath=None,\n        ee_project=None,\n        **site_kwargs,\n    ):\n\n        self._check_gee_initialized(ee_project)\n\n        if geometry:\n            if isinstance(geometry, (ee.Feature, ee.FeatureCollection)):\n                region_geom = geometry.geometry()\n            else:\n                region_geom = ee.Geometry(geometry)\n\n            # Calculate Centroid\n            try:\n                centroid_obj = region_geom.centroid(maxError=1)\n                coords = centroid_obj.coordinates().getInfo()\n            except Exception:\n                centroid_obj = region_geom.bounds(maxError=1).centroid(maxError=1)\n                coords = centroid_obj.coordinates().getInfo()\n\n            self.longitude = coords[0]\n            self.latitude = coords[1]\n\n        elif latitude is not None and longitude is not None:\n            self.latitude = latitude\n            self.longitude = longitude\n        else:\n            raise ValueError(\n                \"Must provide either 'geometry' OR 'latitude' and 'longitude'.\"\n            )\n\n        self.region = ee.Geometry.Point([self.longitude, self.latitude])\n\n        self.start_date = start_date\n        self.end_date = end_date\n        self.source = source.lower()\n        self.filepath = filepath\n        self.site_kwargs = site_kwargs\n\n        self._cached_df = None\n        self._cached_elevation = None\n\n        with pkg_resources.files(configs).joinpath(\"meteo.yaml\").open(\"r\") as f:\n            full_config = yaml.safe_load(f)\n\n        if source.lower() not in full_config:\n            raise ValueError(\n                f\"Source '{source}' not found. Available: {list(full_config.keys())}\"\n            )\n\n        self.weather_config = full_config[source.lower()]\n        self.cfg = ClimateConfig(self.weather_config)\n\n    def _check_gee_initialized(self, project=None):\n        \"\"\"\n        Checks if GEE is initialized. If not, attempts to initialize.\n        \"\"\"\n        try:\n            ee.Image(0).getInfo()\n        except Exception:\n            print(\"GEE not initialized. Attempting initialization...\")\n            try:\n                # Try initializing with specific project if provided, else default\n                if project:\n                    ee.Initialize(project=project)\n                else:\n                    ee.Initialize()\n                print(\"GEE Initialized successfully.\")\n            except Exception as e:\n                raise RuntimeError(\n                    f\"Failed to initialize Earth Engine: {e}.\\n\"\n                    \"Please run 'earthengine authenticate' in your terminal first.\"\n                )\n\n    def _get_elevation(self):\n\n        if self._cached_elevation is not None:\n            return self._cached_elevation\n\n        try:\n            geom = self.region\n            dem_source = self.weather_config.get(\n                \"dem_source\", \"projects/sat-io/open-datasets/GLO-30\"\n            )\n\n            elev = (\n                ee.ImageCollection(dem_source)\n                .filterBounds(geom)\n                .first()\n                .sample(geom, scale=30)\n                .first()\n                .get(\"b1\")\n            )\n\n            val = elev.getInfo()\n            self._cached_elevation = round(float(val), 3) if val is not None else 0.0\n            return self._cached_elevation\n\n        except Exception as e:\n            print(f\"Warning: Could not fetch elevation ({e}). Defaulting to 0.\")\n            self._cached_elevation = 0.0\n            return 0.0\n\n    def _extract_data(self):\n        \"\"\"\n        Extraction of weather data.\n        \"\"\"\n        band_names = self.cfg.get_all_bands()\n        scale = self.weather_config.get(\"default_scale\", 5000)\n        collection_id = self.weather_config.get(\"collection\")\n\n        ic = ee.ImageCollection(collection_id)\n\n        return extract_timeseries_to_point(\n            lat=self.latitude,\n            lon=self.longitude,\n            image_collection=ic,\n            start_date=self.start_date,\n            end_date=self.end_date,\n            band_names=band_names,\n            scale=scale,\n        )\n\n    def get_data(self):\n        if self._cached_df is not None:\n            return self._cached_df\n\n        df_raw = self._extract_data()\n        output = pd.DataFrame(index=df_raw.index)\n        output[\"date\"] = df_raw[\"time\"]\n\n        for var, bands in self.cfg.var_to_bands.items():\n            conversion = self.cfg.var_to_conversion.get(var)\n            converter_func = CONVERSION_FUNCS.get(conversion, lambda x: x)\n\n            inputs = [df_raw[b] for b in bands]\n\n            try:\n                output[var] = converter_func(*inputs)\n            except TypeError as e:\n                raise ValueError(\n                    f\"Error calculating {var}: Function '{conversion}' \"\n                    f\"expected different arguments than provided bands {bands}. \"\n                    f\"Details: {e}\"\n                )\n\n        self._cached_df = output.round(3)\n        return self._cached_df\n\n    def save_weather_excel(self, filepath=None, **override_kwargs):\n        target_path = filepath or self.filepath\n        if not target_path:\n            raise ValueError(\"Invalid filepath.\")\n\n        df = self.get_data()\n\n        meta_defaults = {\n            \"Country\": \"Unknown\",\n            \"Station\": \"Unknown\",\n            \"Description\": self.weather_config.get(\"description\"),\n            \"Source\": self.weather_config.get(\"collection\"),\n            \"Contact\": \"Unknown\",\n            \"Missing values\": -999,\n            \"AngstromA\": 0.25,\n            \"AngstromB\": 0.50,\n            \"HasSunshine\": False,\n        }\n\n        meta = {**meta_defaults, **self.site_kwargs, **override_kwargs}\n\n        excel_rows = []\n\n        excel_rows.append([\"Site Characteristics\"])\n        excel_rows.append([\"Country\", meta[\"Country\"]])\n        excel_rows.append([\"Station\", meta[\"Station\"]])\n        excel_rows.append([\"Description\", meta[\"Description\"]])\n        excel_rows.append([\"Source\", meta[\"Source\"]])\n        excel_rows.append([\"Contact\", meta[\"Contact\"]])\n        excel_rows.append([\"Missing values\", meta[\"Missing values\"]])\n\n        excel_rows.append(\n            [\n                \"Longitude\",\n                \"Latitude\",\n                \"Elevation\",\n                \"AngstromA\",\n                \"AngstromB\",\n                \"HasSunshine\",\n            ]\n        )\n        excel_rows.append(\n            [\n                self.longitude,\n                self.latitude,\n                self._get_elevation(),\n                meta[\"AngstromA\"],\n                meta[\"AngstromB\"],\n                str(meta[\"HasSunshine\"]).upper(),\n            ]\n        )\n\n        excel_rows.append([\"Observed data\"])\n\n        var_order = [\"IRRAD\", \"TMIN\", \"TMAX\", \"VAP\", \"WIND\", \"RAIN\", \"SNOWDEPTH\"]\n        present_vars = [v for v in var_order if v in df.columns]\n\n        header_names = [\"DAY\"] + present_vars\n        excel_rows.append(header_names)\n\n        header_units = [\"date\"]\n        for v in present_vars:\n            if v in self.cfg.var_to_units:\n                header_units.append(self.cfg.var_to_units[v][1])\n            else:\n                header_units.append(\"-\")\n        excel_rows.append(header_units)\n\n        df_export = df.copy()\n        df_export = df_export.fillna(meta[\"Missing values\"])\n        df_export = df_export[[\"date\"] + present_vars]\n\n        with pd.ExcelWriter(target_path, engine=\"openpyxl\") as writer:\n            pd.DataFrame(excel_rows).to_excel(\n                writer, sheet_name=\"Sheet1\", index=False, header=False, startrow=0\n            )\n\n            df_export.to_excel(\n                writer,\n                sheet_name=\"Sheet1\",\n                index=False,\n                header=False,\n                startrow=len(excel_rows),\n            )\n\n        print(f\"File saved successfully to {target_path}\")\n</code></pre>"},{"location":"examples/intro/","title":"Intro","text":"In\u00a0[\u00a0]: Copied! <pre>print(\"Hello World!\")\n</pre> print(\"Hello World!\")"},{"location":"examples/weather/","title":"Weather","text":"In\u00a0[\u00a0]: Copied! <pre>from cropengine.weather import GEEWeatherDataProvider\n</pre> from cropengine.weather import GEEWeatherDataProvider In\u00a0[\u00a0]: Copied! <pre>import ee\nimport geemap\n\nee.Initialize()\n</pre> import ee import geemap  ee.Initialize() In\u00a0[\u00a0]: Copied! <pre>Map = geemap.Map(basemap=\"SATELLITE\")\nMap\n</pre> Map = geemap.Map(basemap=\"SATELLITE\") Map In\u00a0[\u00a0]: Copied! <pre>region = Map.draw_last_feature\n</pre> region = Map.draw_last_feature In\u00a0[\u00a0]: Copied! <pre># climdata = GEEWeatherDataProvider(latitude=52.06912171608079, longitude=10.881185799808796, start_date='2020-01-01', end_date='2022-12-31', source='era5_land')\nclimdata_region = GEEWeatherDataProvider(\n    geometry=region,\n    reducer=\"mean\",\n    start_date=\"2020-01-01\",\n    end_date=\"2022-12-31\",\n    source=\"era5_land\",\n)\n</pre> # climdata = GEEWeatherDataProvider(latitude=52.06912171608079, longitude=10.881185799808796, start_date='2020-01-01', end_date='2022-12-31', source='era5_land') climdata_region = GEEWeatherDataProvider(     geometry=region,     reducer=\"mean\",     start_date=\"2020-01-01\",     end_date=\"2022-12-31\",     source=\"era5_land\", ) In\u00a0[\u00a0]: Copied! <pre>climdata.get_data()\n</pre> climdata.get_data() In\u00a0[\u00a0]: Copied! <pre># climdata_region.save_weather_excel('data.xlsx')\n</pre> # climdata_region.save_weather_excel('data.xlsx')"}]}